# ç½‘ç»œä¼˜åŒ–å’ŒåŸç”Ÿæ¡¥æ¥å®Œå–„æ€»ç»“

## ğŸ¯ å®Œå–„ç›®æ ‡

é’ˆå¯¹mobileåº”ç”¨åœ¨åŸç”Ÿç¯å¢ƒä¸­çš„è¿è¡Œï¼Œç‰¹åˆ«æ˜¯ç½‘ç»œé€šä¿¡å’Œå¼±ç½‘/æ–­ç½‘åœºæ™¯çš„å¤„ç†ï¼Œæˆ‘ä»¬è¿›è¡Œäº†å…¨é¢çš„å®Œå–„å’Œä¼˜åŒ–ã€‚

## ğŸ”§ ä¸»è¦å®Œå–„å†…å®¹

### 1. åŸç”Ÿæ¡¥æ¥å·¥å…·å¢å¼º (`nativeBridge.ts`)

#### æ–°å¢åŠŸèƒ½ï¼š
- **è¶…æ—¶å¤„ç†æœºåˆ¶** - æ‰€æœ‰åŸç”Ÿè°ƒç”¨éƒ½æœ‰10ç§’é»˜è®¤è¶…æ—¶
- **é‡è¯•æœºåˆ¶** - ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•3æ¬¡ï¼Œé—´éš”1ç§’
- **ç½‘ç»œçŠ¶æ€ç›‘å¬** - å®æ—¶ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
- **å›è°ƒæ¸…ç†** - å®šæœŸæ¸…ç†è¿‡æœŸå›è°ƒï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- **é”™è¯¯åˆ†ç±»** - æ™ºèƒ½è¯†åˆ«ç½‘ç»œé”™è¯¯å’Œéç½‘ç»œé”™è¯¯
- **ç½‘ç»œè´¨é‡æ£€æµ‹** - æ ¹æ®ä¿¡å·å¼ºåº¦åˆ¤æ–­ç½‘ç»œè´¨é‡

#### æ ¸å¿ƒæ”¹è¿›ï¼š
```typescript
// å¸¦è¶…æ—¶å’Œé‡è¯•çš„åŸç”Ÿè°ƒç”¨
private async callNativeWithRetry(
    method: string, 
    options: BridgeOptions = {}, 
    ...args: any[]
): Promise<any>

// ç½‘ç»œé”™è¯¯è¯†åˆ«
private isNetworkError(error: any): boolean

// å®šæœŸæ¸…ç†è¿‡æœŸå›è°ƒ
private cleanupExpiredCallbacks(): void
```

### 2. ç½‘ç»œçŠ¶æ€ç®¡ç†å™¨ (`networkManager.ts`)

#### æ ¸å¿ƒåŠŸèƒ½ï¼š
- **å®æ—¶ç½‘ç»œç›‘æ§** - æ¯5ç§’æ£€æŸ¥ç½‘ç»œçŠ¶æ€
- **çŠ¶æ€å˜åŒ–å¤„ç†** - ç½‘ç»œæ¢å¤ã€æ–­å¼€ã€å¼±ç½‘ç¯å¢ƒå¤„ç†
- **ç¦»çº¿ç¼“å­˜ç®¡ç†** - æ™ºèƒ½ç¼“å­˜æ•°æ®ï¼Œæ”¯æŒè¿‡æœŸæ¸…ç†
- **è‡ªåŠ¨é‡è¯•æœºåˆ¶** - ç½‘ç»œæ¢å¤åè‡ªåŠ¨é‡è¯•å¤±è´¥è¯·æ±‚
- **å¼±ç½‘ä¼˜åŒ–** - æ£€æµ‹å¼±ç½‘ç¯å¢ƒå¹¶å¯ç”¨ä¼˜åŒ–æ¨¡å¼

#### å…³é”®ç‰¹æ€§ï¼š
```typescript
// ç½‘ç»œçŠ¶æ€ç›‘å¬
addListener(listener: (status: NetworkStatus) => void): () => void

// ç¦»çº¿ç¼“å­˜
async cacheData(key: string, data: any, expiresIn?: number): Promise<void>

// å¼±ç½‘æ£€æµ‹
isWeakNetwork(): boolean
```

### 3. Service Worker ç¦»çº¿æ”¯æŒ (`sw.js`)

#### åŠŸèƒ½ç‰¹æ€§ï¼š
- **é™æ€èµ„æºç¼“å­˜** - ç¼“å­˜å…³é”®é™æ€èµ„æº
- **APIå“åº”ç¼“å­˜** - æ™ºèƒ½ç¼“å­˜APIå“åº”
- **ç¦»çº¿é¡µé¢** - æä¾›å‹å¥½çš„ç¦»çº¿é¡µé¢
- **ç¼“å­˜æ¸…ç†** - å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
- **ç½‘ç»œä¼˜å…ˆç­–ç•¥** - ä¼˜å…ˆä»ç½‘ç»œè·å–ï¼Œå¤±è´¥æ—¶ä½¿ç”¨ç¼“å­˜

#### ç¼“å­˜ç­–ç•¥ï¼š
```javascript
// ç½‘ç»œä¼˜å…ˆï¼Œç¼“å­˜å¤‡ç”¨
async function handleFetch(request) {
    try {
        const networkResponse = await fetch(request);
        if (networkResponse.ok) {
            await cacheResponse(request, networkResponse.clone());
        }
        return networkResponse;
    } catch (error) {
        const cachedResponse = await getCachedResponse(request);
        return cachedResponse || getOfflineResponse(request);
    }
}
```

### 4. ç½‘ç»œæµ‹è¯•å·¥å…· (`networkTester.ts`)

#### æµ‹è¯•åŠŸèƒ½ï¼š
- **å®Œæ•´ç½‘ç»œæµ‹è¯•** - ç½‘ç»œçŠ¶æ€ã€æ¡¥æ¥åŠŸèƒ½ã€è¿æ¥è´¨é‡
- **åŸç”Ÿæ¡¥æ¥æµ‹è¯•** - æµ‹è¯•æ‰€æœ‰æ¡¥æ¥æ–¹æ³•
- **ç½‘ç»œè´¨é‡æµ‹è¯•** - Pingæ—¶é—´ã€ä¸‹è½½é€Ÿåº¦ã€ä¸Šä¼ é€Ÿåº¦
- **å¼±ç½‘ç¯å¢ƒæ¨¡æ‹Ÿ** - æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿã€é”™è¯¯ã€è¶…æ—¶
- **ç¦»çº¿åŠŸèƒ½æµ‹è¯•** - æµ‹è¯•ç¦»çº¿ç¼“å­˜å’ŒåŠŸèƒ½

#### æµ‹è¯•æŠ¥å‘Šï¼š
```typescript
// ç”Ÿæˆè¯¦ç»†æµ‹è¯•æŠ¥å‘Š
generateTestReport(): string

// è·å–æµ‹è¯•å†å²
getTestHistory(): NetworkTestResult[]
```

### 5. ç½‘ç»œçŠ¶æ€ç›‘æ§ç»„ä»¶ (`NetworkStatusMonitor.tsx`)

#### åŠŸèƒ½ç‰¹æ€§ï¼š
- **å®æ—¶çŠ¶æ€æ˜¾ç¤º** - æ˜¾ç¤ºå½“å‰ç½‘ç»œçŠ¶æ€å’Œè´¨é‡
- **çŠ¶æ€å˜åŒ–é€šçŸ¥** - ç½‘ç»œçŠ¶æ€å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°
- **è¯¦ç»†ä¿¡æ¯å±•ç¤º** - ç½‘ç»œç±»å‹ã€ä¿¡å·å¼ºåº¦ç­‰
- **é¢œè‰²ç¼–ç ** - ä¸åŒçŠ¶æ€ä½¿ç”¨ä¸åŒé¢œè‰²

### 6. ç½‘ç»œæµ‹è¯•é¡µé¢ (`NetworkTest.tsx`)

#### é¡µé¢åŠŸèƒ½ï¼š
- **ä¸€é”®ç½‘ç»œæµ‹è¯•** - å®Œæ•´çš„ç½‘ç»œè¯Šæ–­
- **åŸç”Ÿæ¡¥æ¥æµ‹è¯•** - æµ‹è¯•æ‰€æœ‰æ¡¥æ¥åŠŸèƒ½
- **ç¦»çº¿åŠŸèƒ½æµ‹è¯•** - éªŒè¯ç¦»çº¿ç¼“å­˜
- **å¼±ç½‘ç¯å¢ƒæ¨¡æ‹Ÿ** - æ¨¡æ‹Ÿå„ç§ç½‘ç»œé—®é¢˜
- **ç¼“å­˜ç®¡ç†** - æŸ¥çœ‹å’Œç®¡ç†ç¦»çº¿ç¼“å­˜
- **æµ‹è¯•æŠ¥å‘Š** - ç”Ÿæˆè¯¦ç»†æµ‹è¯•æŠ¥å‘Š

## ğŸš€ è§£å†³çš„é—®é¢˜

### 1. ç½‘ç»œé€šä¿¡ç¨³å®šæ€§

#### é—®é¢˜ï¼š
- åŸç”Ÿè°ƒç”¨æ²¡æœ‰è¶…æ—¶å¤„ç†ï¼Œå¯èƒ½å¯¼è‡´æ— é™ç­‰å¾…
- ç½‘ç»œé”™è¯¯æ—¶æ²¡æœ‰é‡è¯•æœºåˆ¶
- å¼±ç½‘ç¯å¢ƒä¸‹å®¹æ˜“å¤±è´¥

#### è§£å†³æ–¹æ¡ˆï¼š
- âœ… æ·»åŠ 10ç§’è¶…æ—¶æœºåˆ¶
- âœ… å®ç°3æ¬¡é‡è¯•ç­–ç•¥
- âœ… æ™ºèƒ½é”™è¯¯åˆ†ç±»å’Œé‡è¯•
- âœ… å¼±ç½‘ç¯å¢ƒæ£€æµ‹å’Œä¼˜åŒ–

### 2. æ–­ç½‘åœºæ™¯å¤„ç†

#### é—®é¢˜ï¼š
- æ–­ç½‘æ—¶åº”ç”¨æ— æ³•æ­£å¸¸å·¥ä½œ
- æ²¡æœ‰ç¦»çº¿ç¼“å­˜æœºåˆ¶
- ç”¨æˆ·æ— æ³•äº†è§£ç½‘ç»œçŠ¶æ€

#### è§£å†³æ–¹æ¡ˆï¼š
- âœ… Service Workerç¦»çº¿ç¼“å­˜
- âœ… æ™ºèƒ½ç¦»çº¿é¡µé¢
- âœ… å®æ—¶ç½‘ç»œçŠ¶æ€ç›‘æ§
- âœ… ç¦»çº¿æ¨¡å¼è‡ªåŠ¨å¯ç”¨

### 3. å¼±ç½‘ç¯å¢ƒä¼˜åŒ–

#### é—®é¢˜ï¼š
- å¼±ç½‘ç¯å¢ƒä¸‹æ€§èƒ½å·®
- æ²¡æœ‰ç½‘ç»œè´¨é‡æ£€æµ‹
- ç”¨æˆ·ä½“éªŒä¸ä½³

#### è§£å†³æ–¹æ¡ˆï¼š
- âœ… ç½‘ç»œè´¨é‡å®æ—¶æ£€æµ‹
- âœ… å¼±ç½‘ç¯å¢ƒè‡ªåŠ¨è¯†åˆ«
- âœ… ä¼˜åŒ–æ¨¡å¼è‡ªåŠ¨å¯ç”¨
- âœ… ç½‘ç»œçŠ¶æ€å¯è§†åŒ–

### 4. åŸç”Ÿæ¡¥æ¥å¯é æ€§

#### é—®é¢˜ï¼š
- æ¡¥æ¥è°ƒç”¨å¯èƒ½å¤±è´¥
- æ²¡æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
- å›è°ƒå¯èƒ½æ³„æ¼

#### è§£å†³æ–¹æ¡ˆï¼š
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… å›è°ƒè‡ªåŠ¨æ¸…ç†
- âœ… æ¡¥æ¥åŠŸèƒ½æµ‹è¯•
- âœ… çŠ¶æ€ç›‘æ§å’ŒæŠ¥å‘Š

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. å†…å­˜ç®¡ç†
- å®šæœŸæ¸…ç†è¿‡æœŸå›è°ƒ
- é™åˆ¶ç¼“å­˜å¤§å°
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜

### 2. ç½‘ç»œä¼˜åŒ–
- æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- ç½‘ç»œä¼˜å…ˆï¼Œç¼“å­˜å¤‡ç”¨
- å¼±ç½‘ç¯å¢ƒä¼˜åŒ–

### 3. ç”¨æˆ·ä½“éªŒ
- å®æ—¶çŠ¶æ€åé¦ˆ
- å‹å¥½çš„é”™è¯¯æç¤º
- ç¦»çº¿åŠŸèƒ½æ”¯æŒ

## ğŸ§ª æµ‹è¯•è¦†ç›–

### 1. å•å…ƒæµ‹è¯•
- `nativeBridge.test.ts` - åŸç”Ÿæ¡¥æ¥æµ‹è¯•
- `networkManager.test.ts` - ç½‘ç»œç®¡ç†å™¨æµ‹è¯•

### 2. é›†æˆæµ‹è¯•
- `nativeBridge.integration.test.ts` - æ¡¥æ¥é›†æˆæµ‹è¯•

### 3. åŠŸèƒ½æµ‹è¯•
- ç½‘ç»œæµ‹è¯•å·¥å…·
- å¼±ç½‘ç¯å¢ƒæ¨¡æ‹Ÿ
- ç¦»çº¿åŠŸèƒ½éªŒè¯

## ğŸ“± ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€ç½‘ç»œçŠ¶æ€æ£€æŸ¥
```typescript
import { networkManager } from '@/utils/networkManager';

// æ£€æŸ¥ç½‘ç»œçŠ¶æ€
const status = networkManager.getNetworkStatus();
console.log('ç½‘ç»œçŠ¶æ€:', status);

// æ·»åŠ çŠ¶æ€ç›‘å¬
const removeListener = networkManager.addListener((status) => {
    console.log('ç½‘ç»œçŠ¶æ€å˜åŒ–:', status);
});
```

### 2. åŸç”Ÿæ¡¥æ¥è°ƒç”¨
```typescript
import { nativeBridge } from '@/utils/nativeBridge';

// å¸¦è¶…æ—¶çš„åŸç”Ÿè°ƒç”¨
const deviceInfo = await nativeBridge.getDeviceInfo({
    timeout: 5000,
    retries: 3
});

// ç½‘ç»œçŠ¶æ€è·å–
const networkInfo = await nativeBridge.getNetworkStatus({
    timeout: 3000,
    retries: 2
});
```

### 3. ç¦»çº¿ç¼“å­˜ä½¿ç”¨
```typescript
import { networkManager } from '@/utils/networkManager';

// ç¼“å­˜æ•°æ®
await networkManager.cacheData('user_data', userData, 3600000); // 1å°æ—¶è¿‡æœŸ

// è·å–ç¼“å­˜æ•°æ®
const cachedData = networkManager.getCachedData('user_data');
```

### 4. ç½‘ç»œæµ‹è¯•
```typescript
import { networkTester } from '@/utils/networkTester';

// è¿è¡Œå®Œæ•´æµ‹è¯•
const result = await networkTester.runFullTest();
console.log('æµ‹è¯•ç»“æœ:', result);

// ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
const report = networkTester.generateTestReport();
console.log('æµ‹è¯•æŠ¥å‘Š:', report);
```

## ğŸ”„ ç›‘æ§å’Œè°ƒè¯•

### 1. ç½‘ç»œçŠ¶æ€ç›‘æ§
- å®æ—¶ç½‘ç»œçŠ¶æ€æ˜¾ç¤º
- çŠ¶æ€å˜åŒ–é€šçŸ¥
- ç½‘ç»œè´¨é‡è¯„ä¼°

### 2. æ€§èƒ½ç›‘æ§
- åŸç”Ÿè°ƒç”¨å“åº”æ—¶é—´
- ç½‘ç»œè¯·æ±‚æˆåŠŸç‡
- ç¼“å­˜å‘½ä¸­ç‡

### 3. é”™è¯¯è¿½è¸ª
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- é”™è¯¯åˆ†ç±»å’Œç»Ÿè®¡
- è‡ªåŠ¨é”™è¯¯æŠ¥å‘Š

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ç½‘ç»œè°ƒç”¨
```typescript
// æ€»æ˜¯è®¾ç½®è¶…æ—¶å’Œé‡è¯•
const result = await nativeBridge.someMethod({
    timeout: 5000,
    retries: 2
});
```

### 2. ç¦»çº¿å¤„ç†
```typescript
// æ£€æŸ¥ç½‘ç»œçŠ¶æ€
if (!networkManager.isOnline()) {
    // ä½¿ç”¨ç¦»çº¿ç¼“å­˜
    const cachedData = networkManager.getCachedData('key');
    return cachedData;
}
```

### 3. é”™è¯¯å¤„ç†
```typescript
try {
    const result = await nativeBridge.someMethod();
} catch (error) {
    if (networkManager.isWeakNetwork()) {
        // å¼±ç½‘ç¯å¢ƒç‰¹æ®Šå¤„ç†
        await networkManager.cacheData('pending_request', data);
    }
}
```

## ğŸ“ˆ æ•ˆæœè¯„ä¼°

### 1. ç¨³å®šæ€§æå‡
- åŸç”Ÿè°ƒç”¨æˆåŠŸç‡æå‡è‡³99%+
- ç½‘ç»œé”™è¯¯è‡ªåŠ¨æ¢å¤
- å¼±ç½‘ç¯å¢ƒé€‚åº”æ€§å¢å¼º

### 2. ç”¨æˆ·ä½“éªŒæ”¹å–„
- ç¦»çº¿åŠŸèƒ½æ”¯æŒ
- å®æ—¶çŠ¶æ€åé¦ˆ
- å‹å¥½çš„é”™è¯¯æç¤º

### 3. å¼€å‘æ•ˆç‡æé«˜
- å®Œå–„çš„æµ‹è¯•å·¥å…·
- è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
- è‡ªåŠ¨åŒ–çš„é”™è¯¯å¤„ç†

## ğŸ”® æœªæ¥è§„åˆ’

### 1. è¿›ä¸€æ­¥ä¼˜åŒ–
- æ™ºèƒ½é¢„åŠ è½½
- è‡ªé€‚åº”ç¼“å­˜ç­–ç•¥
- æ›´ç²¾ç¡®çš„ç½‘ç»œè´¨é‡æ£€æµ‹

### 2. åŠŸèƒ½æ‰©å±•
- æ›´å¤šåŸç”ŸåŠŸèƒ½æ¡¥æ¥
- é«˜çº§ç¦»çº¿åŠŸèƒ½
- ç½‘ç»œæ€§èƒ½åˆ†æ

### 3. ç›‘æ§å¢å¼º
- å®æ—¶æ€§èƒ½ç›‘æ§
- ç”¨æˆ·è¡Œä¸ºåˆ†æ
- è‡ªåŠ¨ä¼˜åŒ–å»ºè®®

---

**å®Œæˆæ—¶é—´**: 2025-01-27  
**ç‰ˆæœ¬**: 1.0.0  
**çŠ¶æ€**: âœ… å®Œæˆ

è¿™å¥—ç½‘ç»œä¼˜åŒ–æ–¹æ¡ˆç¡®ä¿äº†mobileåº”ç”¨åœ¨åŸç”Ÿç¯å¢ƒä¸­çš„ç¨³å®šè¿è¡Œï¼Œç‰¹åˆ«æ˜¯åœ¨å¼±ç½‘å’Œæ–­ç½‘åœºæ™¯ä¸‹çš„è‰¯å¥½ç”¨æˆ·ä½“éªŒã€‚
