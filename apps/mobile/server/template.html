<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="移动端技术文章阅读平台">
    <title>{{title}}</title>

    <!-- SEO Meta Tags -->
    <meta property="og:title" content="{{title}}">
    <meta property="og:description" content="{{description}}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{url}}">
    <meta property="og:image" content="{{image}}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{title}}">
    <meta name="twitter:description" content="{{description}}">
    <meta name="twitter:image" content="{{image}}">

    <!-- Mobile Optimization -->
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="技术文章">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="/assets/main.css" as="style">
    <link rel="preload" href="/assets/main.js" as="script">

    <!-- Styles -->
    {{styles}}

    <!-- Critical CSS for above-the-fold content -->
    <style>
        /* Critical CSS for initial render */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f9fafb;
            color: #111827;
        }

        .loading-skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .safe-area-pb {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* Hide content until hydrated to prevent FOUC */
        #root:empty::after {
            content: '';
            display: block;
            width: 100%;
            height: 100vh;
            background-color: #f9fafb;
        }
    </style>
</head>

<body>
    <div id="root">{{html}}</div>

    <!-- Initial Data -->
    <script>
        window.__INITIAL_DATA__ = {{ initialData }};
        window.__SSR_CONTEXT__ = {{ ssrContext }};
    </script>

    <!-- Scripts -->
    {{scripts}}

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>

    <!-- Performance Monitoring -->
    <script>
        // 监控首屏渲染时间
        window.addEventListener('load', () => {
            if (window.performance && window.performance.timing) {
                const timing = window.performance.timing;
                const loadTime = timing.loadEventEnd - timing.navigationStart;
                console.log('Page load time:', loadTime + 'ms');

                // 发送性能数据到分析服务
                if (window.gtag) {
                    window.gtag('event', 'timing_complete', {
                        name: 'load',
                        value: loadTime
                    });
                }
            }
        });
    </script>
</body>

</html>