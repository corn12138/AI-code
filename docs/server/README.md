# ğŸ–¥ï¸ Server åº”ç”¨æ–‡æ¡£

åŸºäº NestJS çš„ä¼ä¸šçº§åç«¯æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„ API æ¥å£ã€è®¤è¯ç³»ç»Ÿã€æ•°æ®åº“ç®¡ç†å’Œç›‘æ§åŠŸèƒ½ã€‚

## ğŸš€ åº”ç”¨ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **ä¼ä¸šçº§æ¶æ„**: NestJS 9.0 + TypeScript + PostgreSQL
- **è®¤è¯ç³»ç»Ÿ**: JWT è®¤è¯ã€æƒé™ç®¡ç†ã€ç”¨æˆ·ç®¡ç†
- **API æ¥å£**: RESTful APIã€æ–‡ç« ç®¡ç†ã€æ ‡ç­¾ç³»ç»Ÿã€ç§»åŠ¨ç«¯ BFF
- **æ•°æ®åº“ç®¡ç†**: TypeORM + PostgreSQL + æ•°æ®è¿ç§»
- **ç›‘æ§ç³»ç»Ÿ**: Prometheus + Grafana ç›‘æ§
- **æµ‹è¯•è¦†ç›–**: Vitest 3.2 + å®Œæ•´æµ‹è¯•åŸºç¡€è®¾æ–½
- **ä¸‰ç«¯ç»Ÿä¸€**: Mobile BFF æ¶æ„æ”¯æŒ iOSã€Androidã€Web

### æŠ€æœ¯äº®ç‚¹
- **NestJS 9.0**: ä¼ä¸šçº§ Node.js æ¡†æ¶
- **TypeORM**: å¼ºå¤§çš„ ORM å·¥å…·å’Œæ•°æ®è¿ç§»
- **Vitest 3.2**: é«˜æ€§èƒ½æµ‹è¯•æ¡†æ¶
- **Swagger**: API æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
- **Docker æ”¯æŒ**: å®¹å™¨åŒ–éƒ¨ç½²
- **åä¸ºäº‘éƒ¨ç½²**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ”¯æŒ
- **ç¼“å­˜ç®¡ç†**: Redis ç¼“å­˜æ”¯æŒ
- **é™æµä¿æŠ¤**: Throttler é™æµä¸­é—´ä»¶

## ğŸ“ é¡¹ç›®ç»“æ„

```
server/
â”œâ”€â”€ docs/                    # ğŸ“š æ–‡æ¡£ä¸­å¿ƒ
â”‚   â””â”€â”€ VITEST_*.md         # ğŸ§ª Vitest å‡çº§æ–‡æ¡£
â”œâ”€â”€ src/                    # ğŸ’» æºä»£ç 
â”‚   â”œâ”€â”€ app.module.ts       # ğŸ“¦ åº”ç”¨æ¨¡å—
â”‚   â”œâ”€â”€ auth/               # ğŸ” è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ article/            # ğŸ“ æ–‡ç« æ¨¡å—
â”‚   â”œâ”€â”€ articles/           # ğŸ“š æ–‡ç« ç®¡ç†
â”‚   â”œâ”€â”€ mobile/             # ğŸ“± ç§»åŠ¨ç«¯ API
â”‚   â”œâ”€â”€ health/             # ğŸ¥ å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ metrics/            # ğŸ“Š ç›‘æ§æŒ‡æ ‡
â”‚   â”œâ”€â”€ tags/               # ğŸ·ï¸ æ ‡ç­¾ç³»ç»Ÿ
â”‚   â”œâ”€â”€ user/                # ğŸ‘¤ ç”¨æˆ·ç®¡ç†
â”‚   â””â”€â”€ common/             # ğŸ”§ é€šç”¨æ¨¡å—
â”œâ”€â”€ test/                   # ğŸ§ª æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ api/                # ğŸ“¡ API æµ‹è¯•
â”‚   â”œâ”€â”€ integration/        # ğŸ”— é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ e2e/                # ğŸ¯ ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â””â”€â”€ performance/        # âš¡ æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ scripts/                # ğŸ”§ è„šæœ¬å·¥å…·
â””â”€â”€ logs/                   # ğŸ“ æ—¥å¿—æ–‡ä»¶
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆè¯¦æƒ…

### æ ¸å¿ƒæ¡†æ¶
- **NestJS**: 9.0.0 (ä¼ä¸šçº§ Node.js æ¡†æ¶)
- **TypeScript**: æœ€æ–°ç‰ˆæœ¬ (ç±»å‹å®‰å…¨)
- **Node.js**: 18+ (è¿è¡Œæ—¶ç¯å¢ƒ)
- **Express**: åº•å±‚ HTTP æœåŠ¡å™¨

### æ•°æ®åº“å’Œ ORM
- **PostgreSQL**: ä¸»æ•°æ®åº“
- **TypeORM**: 9.0.1 (ORM æ¡†æ¶)
- **æ•°æ®åº“è¿ç§»**: è‡ªåŠ¨è¿ç§»ç®¡ç†
- **è¿æ¥æ± **: æ•°æ®åº“è¿æ¥ä¼˜åŒ–

### è®¤è¯å’Œå®‰å…¨
- **JWT**: 10.0.3 (JSON Web Token)
- **Passport**: 9.0.3 (è®¤è¯ç­–ç•¥)
- **bcrypt**: 6.0.0 (å¯†ç åŠ å¯†)
- **Throttler**: 4.0.0 (é™æµä¿æŠ¤)

### API å’Œæ–‡æ¡£
- **Swagger**: 6.3.0 (API æ–‡æ¡£)
- **Validation**: æ•°æ®éªŒè¯
- **Serialization**: æ•°æ®åºåˆ—åŒ–
- **OpenAPI**: API è§„èŒƒ

### ç›‘æ§å’Œå¥åº·æ£€æŸ¥
- **Prometheus**: 6.0.2 (æŒ‡æ ‡æ”¶é›†)
- **Terminus**: 11.0.0 (å¥åº·æ£€æŸ¥)
- **Metrics**: æ€§èƒ½ç›‘æ§

### ç¼“å­˜å’Œæ€§èƒ½
- **Cache Manager**: 3.0.1 (ç¼“å­˜ç®¡ç†)
- **Redis**: ç¼“å­˜å­˜å‚¨ (å¯é€‰)

### æµ‹è¯•æ¡†æ¶
- **Vitest**: 3.2.4 (æµ‹è¯•æ¡†æ¶)
- **Testing Library**: æµ‹è¯•å·¥å…·
- **Coverage**: ä»£ç è¦†ç›–ç‡
- **Mock**: æµ‹è¯•æ¨¡æ‹Ÿ

### éƒ¨ç½²å’Œ DevOps
- **Docker**: å®¹å™¨åŒ–éƒ¨ç½²
- **åä¸ºäº‘**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- **CI/CD**: è‡ªåŠ¨åŒ–éƒ¨ç½²

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **Node.js**: >= 18
- **pnpm**: >= 8
- **PostgreSQL**: >= 13
- **Docker**: (å¯é€‰)

### å®‰è£…ä¾èµ–
```bash
pnpm install
```

### æ•°æ®åº“è®¾ç½®
```bash
# è®¾ç½®æ•°æ®åº“
./setup-database.sh

# æˆ–æ‰‹åŠ¨è®¾ç½®
pnpm db:generate
pnpm db:push
pnpm db:seed
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
pnpm dev
```

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œå•å…ƒæµ‹è¯•
pnpm test:unit

# è¿è¡Œé›†æˆæµ‹è¯•
pnpm test:integration

# è¿è¡Œæ€§èƒ½æµ‹è¯•
pnpm test:performance
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

### ğŸ—ï¸ æ¶æ„æ–‡æ¡£
- [é…ç½®æ–‡æ¡£](./configuration.md) - åº”ç”¨é…ç½®è¯´æ˜
- [å¼€å‘æ–‡æ¡£](./development.md) - å¼€å‘æŒ‡å—å’Œæœ€ä½³å®è·µ

### ğŸ“Š é¡¹ç›®æŠ¥å‘Š
- [åç«¯æµ‹è¯•è¯„ä¼°](../reports/testing/BACKEND_TESTING_EVALUATION.md) - æµ‹è¯•ç³»ç»Ÿè¯„ä¼°
- [æ¸…ç†æŠ¥å‘Š](../reports/testing/CLEANUP_REPORT.md) - é¡¹ç›®æ¸…ç†è®°å½•
- [Jest æ¸…ç†æŠ¥å‘Š](../reports/testing/JEST_CLEANUP_REPORT.md) - Jest è¿ç§»æ¸…ç†
- [çœŸå®é¡¹ç›®æµ‹è¯•æŠ¥å‘Š](../reports/testing/REAL_PROJECT_TESTING_REPORT.md) - å®é™…é¡¹ç›®æµ‹è¯•
- [æœåŠ¡ç«¯å¯åŠ¨æˆåŠŸæŠ¥å‘Š](../reports/testing/SERVER_STARTUP_SUCCESS_REPORT.md) - å¯åŠ¨éªŒè¯
- [æµ‹è¯•æœ€ç»ˆæŠ¥å‘Š](../reports/testing/TEST_FINAL_REPORT.md) - æµ‹è¯•å®Œæˆæ€»ç»“
- [æµ‹è¯•å®ç°æŠ¥å‘Š](../reports/testing/TEST_IMPLEMENTATION_REPORT.md) - æµ‹è¯•å®ç°è¯¦æƒ…
- [æµ‹è¯•è¿›åº¦æŠ¥å‘Š](../reports/testing/TEST_PROGRESS_REPORT.md) - æµ‹è¯•è¿›åº¦è·Ÿè¸ª
- [Vitest å®ç°æ€»ç»“](../reports/testing/VITEST_IMPLEMENTATION_SUMMARY.md) - Vitest å®ç°
- [Vitest è¿ç§»æŠ¥å‘Š](../reports/testing/VITEST_MIGRATION_REPORT.md) - è¿ç§»è¿‡ç¨‹

### ğŸ§ª æµ‹è¯•æŒ‡å—
- [æµ‹è¯•å¼€å‘è®¡åˆ’](../testing/TEST_DEVELOPMENT_PLAN.md) - æµ‹è¯•å¼€å‘è®¡åˆ’
- [æµ‹è¯•æœ€ä½³å®è·µ](../testing/testing-best-practices.md) - æµ‹è¯•æœ€ä½³å®è·µ
- [Vitest æ€§èƒ½ä¼˜åŒ–](../testing/VITEST_PERFORMANCE_OPTIMIZATION.md) - æ€§èƒ½ä¼˜åŒ–
- [Vitest æµ‹è¯•æŒ‡å—](../testing/VITEST_TESTING_GUIDE.md) - æµ‹è¯•ä½¿ç”¨æŒ‡å—

## ğŸ¯ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯
- **NestJS**: ä¼ä¸šçº§ Node.js æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨å¼€å‘
- **TypeORM**: å¼ºå¤§çš„ ORM å·¥å…·
- **PostgreSQL**: å…³ç³»å‹æ•°æ®åº“
- **JWT**: èº«ä»½è®¤è¯
- **Passport**: è®¤è¯ç­–ç•¥

### æµ‹è¯•æŠ€æœ¯
- **Vitest**: é«˜æ€§èƒ½æµ‹è¯•æ¡†æ¶
- **Testcontainers**: é›†æˆæµ‹è¯•
- **Supertest**: API æµ‹è¯•
- **Faker.js**: æµ‹è¯•æ•°æ®ç”Ÿæˆ

### ç›‘æ§æŠ€æœ¯
- **Prometheus**: æŒ‡æ ‡æ”¶é›†
- **Grafana**: ç›‘æ§é¢æ¿
- **è‡ªå®šä¹‰æŒ‡æ ‡**: ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

## ğŸš€ éƒ¨ç½²

### Docker éƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t server-app .

# è¿è¡Œå®¹å™¨
docker run -p 3001:3001 server-app
```

### åä¸ºäº‘éƒ¨ç½²
```bash
# ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy-to-huaweicloud.sh
```

### ä¼ ç»Ÿéƒ¨ç½²
```bash
# æ„å»ºé¡¹ç›®
pnpm build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm start
```

## ğŸ“Š API æ¥å£

### è®¤è¯æ¥å£
- `POST /auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /auth/login` - ç”¨æˆ·ç™»å½•
- `POST /auth/refresh` - åˆ·æ–°ä»¤ç‰Œ
- `GET /auth/profile` - è·å–ç”¨æˆ·ä¿¡æ¯

### æ–‡ç« æ¥å£
- `GET /articles` - è·å–æ–‡ç« åˆ—è¡¨
- `GET /articles/:id` - è·å–æ–‡ç« è¯¦æƒ…
- `POST /articles` - åˆ›å»ºæ–‡ç« 
- `PUT /articles/:id` - æ›´æ–°æ–‡ç« 
- `DELETE /articles/:id` - åˆ é™¤æ–‡ç« 

### ç§»åŠ¨ç«¯æ¥å£
- `GET /mobile/docs` - è·å–ç§»åŠ¨ç«¯æ–‡æ¡£
- `GET /mobile/docs/:id` - è·å–æ–‡æ¡£è¯¦æƒ…

### å¥åº·æ£€æŸ¥
- `GET /health` - å¥åº·æ£€æŸ¥
- `GET /metrics` - ç›‘æ§æŒ‡æ ‡

## ğŸ§ª æµ‹è¯•è¦†ç›–

### æµ‹è¯•ç±»å‹
- **å•å…ƒæµ‹è¯•**: æœåŠ¡å±‚å’Œæ§åˆ¶å™¨æµ‹è¯•
- **é›†æˆæµ‹è¯•**: æ•°æ®åº“å’Œ API é›†æˆæµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**: å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**: è´Ÿè½½å’Œå‹åŠ›æµ‹è¯•

### æµ‹è¯•å·¥å…·
- **Vitest**: ä¸»è¦æµ‹è¯•æ¡†æ¶
- **Testcontainers**: æ•°æ®åº“æµ‹è¯•
- **Supertest**: API æµ‹è¯•
- **Faker.js**: æµ‹è¯•æ•°æ®ç”Ÿæˆ

## ğŸ“ˆ é¡¹ç›®çŠ¶æ€

- âœ… **Vitest å‡çº§**: å·²å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
- âœ… **æµ‹è¯•è¦†ç›–**: å®Œæ•´çš„æµ‹è¯•åŸºç¡€è®¾æ–½
- âœ… **API å®Œæ•´**: æ‰€æœ‰æ¥å£å·²å®ç°
- âœ… **è®¤è¯ç³»ç»Ÿ**: å®Œæ•´çš„ç”¨æˆ·è®¤è¯
- âœ… **ç›‘æ§ç³»ç»Ÿ**: Prometheus + Grafana
- âœ… **éƒ¨ç½²å°±ç»ª**: Docker å’Œç”Ÿäº§ç¯å¢ƒé…ç½®

## ğŸ”— ç›¸å…³é“¾æ¥

- [åº”ç”¨æ ¹ç›®å½•](../../apps/server/)
- [NestJS é…ç½®](../../apps/server/nest-cli.json)
- [TypeScript é…ç½®](../../apps/server/tsconfig.json)
- [æµ‹è¯•é…ç½®](../../apps/server/vitest.config.ts)
- [Docker é…ç½®](../../apps/server/Dockerfile)

---

*æœ€åæ›´æ–°: 2025-01-03*
*ç»´æŠ¤è€…: AI Assistant*