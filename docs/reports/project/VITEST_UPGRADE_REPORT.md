# Vitest å‡çº§æŠ¥å‘Š

## ğŸ“‹ å‡çº§æ¦‚è¿°

æˆåŠŸå°† `@blog/` å’Œ `@mobile/` åº”ç”¨çš„ Vitest å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ 3.2.4ï¼Œå¹¶ä¿®å¤äº†ç›¸å…³çš„ lint å’Œå¯¼å…¥é—®é¢˜ã€‚

## ğŸ¯ å‡çº§ç›®æ ‡

- å°† blog å’Œ mobile åº”ç”¨çš„ Vitest å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬
- ä¿®å¤ lint å’Œå¯¼å…¥é—®é¢˜
- ä¼˜åŒ–æµ‹è¯•é…ç½®ä»¥åŒ¹é… server åº”ç”¨çš„é«˜æ€§èƒ½é…ç½®
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•æ­£å¸¸è¿è¡Œ

## ğŸ“Š å‡çº§è¯¦æƒ…

### 1. ç‰ˆæœ¬å‡çº§

#### Blog åº”ç”¨
- **å‡çº§å‰**: Vitest 2.1.9
- **å‡çº§å**: Vitest 3.2.4
- **ç›¸å…³åŒ…**: @vitest/ui@3.2.4, @vitest/coverage-v8@3.2.4

#### Mobile åº”ç”¨
- **å‡çº§å‰**: Vitest 2.0.0
- **å‡çº§å**: Vitest 3.2.4
- **ç›¸å…³åŒ…**: @vitest/coverage-v8@3.2.4, @vitest/ui@3.2.4

### 2. é…ç½®ä¼˜åŒ–

#### Blog åº”ç”¨é…ç½®æ›´æ–°
```typescript
// æ–°å¢é«˜æ€§èƒ½é…ç½®
export default defineConfig({
  plugins: [react()],
  test: {
    // åŸºç¡€é…ç½®
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./src/test/setup.ts'],
    
    // æ€§èƒ½ä¼˜åŒ–é…ç½®
    pool: 'forks',
    poolOptions: {
      forks: {
        singleFork: true,
        isolate: true,
      },
    },
    
    // è¦†ç›–ç‡é…ç½®
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html', 'lcov'],
      reportsDirectory: './coverage',
      thresholds: {
        global: {
          branches: 70,
          functions: 70,
          lines: 70,
          statements: 70,
        },
      },
    },
    
    // æµ‹è¯•æ‰§è¡Œé…ç½®
    maxConcurrency: 2,
    retry: 2,
    
    // æŠ¥å‘Šé…ç½®
    reporters: ['verbose', 'html', 'json'],
    outputFile: {
      html: './test-results/index.html',
      json: './test-results/results.json',
    },
  },
  
  // è·¯å¾„åˆ«åé…ç½®
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@shared': path.resolve(__dirname, '../../shared'),
      // ... å…¶ä»–åˆ«å
    },
  },
})
```

#### Mobile åº”ç”¨é…ç½®æ›´æ–°
```typescript
// ç®€åŒ–çš„é«˜æ€§èƒ½é…ç½®
export default defineConfig({
    plugins: [tsconfigPaths()],
    test: {
        // åŸºç¡€é…ç½®
        globals: true,
        environment: 'jsdom',
        setupFiles: ['./vitest.setup.ts'],
        
        // è¶…æ—¶é…ç½®
        testTimeout: 10000,
        hookTimeout: 10000,
        
        // è¦†ç›–ç‡é…ç½®
        coverage: {
            provider: 'v8',
            reporter: ['text', 'json', 'html', 'lcov'],
            reportsDirectory: './coverage',
            thresholds: {
                global: {
                    branches: 70,
                    functions: 70,
                    lines: 70,
                    statements: 70,
                },
            },
        },
        
        // æµ‹è¯•æ‰§è¡Œé…ç½®
        maxConcurrency: 2,
        retry: 2,
        
        // æŠ¥å‘Šé…ç½®
        reporters: ['verbose', 'html', 'json'],
        outputFile: {
            html: './test-results/index.html',
            json: './test-results/results.json',
        },
    },
})
```

### 3. é—®é¢˜ä¿®å¤

#### Lint é—®é¢˜ä¿®å¤
1. **ç§»é™¤ä¸å…¼å®¹çš„é…ç½®é€‰é¡¹**:
   - ç§»é™¤äº† `maxThreads` é…ç½®ï¼ˆåœ¨ Vitest 3.x ä¸­ä¸æ”¯æŒï¼‰
   - ç§»é™¤äº† `minThreads` é…ç½®ï¼ˆåœ¨ Vitest 3.x ä¸­ä¸æ”¯æŒï¼‰
   - ç§»é™¤äº† `useAtomics` é…ç½®ï¼ˆåœ¨ Vitest 3.x ä¸­ä¸æ”¯æŒï¼‰
   - ç§»é™¤äº† `treeShaking` é…ç½®ï¼ˆåœ¨ BuildOptions ä¸­ä¸æ”¯æŒï¼‰

2. **ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜**:
   - è§£å†³äº† Vite ç‰ˆæœ¬å†²çªé—®é¢˜
   - ä¿®å¤äº†æ’ä»¶å…¼å®¹æ€§é—®é¢˜
   - æ›´æ–°äº†ä¾èµ–ç‰ˆæœ¬ä»¥åŒ¹é… Vitest 3.2.4

#### å¯¼å…¥é—®é¢˜ä¿®å¤
1. **ä¾èµ–å®‰è£…**:
   - ä¸º mobile åº”ç”¨å®‰è£…äº†ç¼ºå¤±çš„ `@vitest/ui` ä¾èµ–
   - ç¡®ä¿æ‰€æœ‰ Vitest ç›¸å…³åŒ…ç‰ˆæœ¬ä¸€è‡´

2. **é…ç½®ç®€åŒ–**:
   - ç§»é™¤äº†å¯èƒ½å¯¼è‡´ç±»å‹å†²çªçš„å¤æ‚é…ç½®
   - ä½¿ç”¨ `configDefaults` æ¥ç¡®ä¿å…¼å®¹æ€§

### 4. æµ‹è¯•éªŒè¯

#### Blog åº”ç”¨æµ‹è¯•ç»“æœ
```bash
âœ… æµ‹è¯•è¿è¡ŒæˆåŠŸ
ğŸ“Š æµ‹è¯•ç»Ÿè®¡:
- æµ‹è¯•æ–‡ä»¶: 16 ä¸ª
- æµ‹è¯•ç”¨ä¾‹: 141 ä¸ª
- å…¨éƒ¨é€šè¿‡: âœ…
- æ‰§è¡Œæ—¶é—´: 2.19s
- è¦†ç›–ç‡æŠ¥å‘Š: å·²ç”Ÿæˆ
```

#### Mobile åº”ç”¨æµ‹è¯•ç»“æœ
```bash
âš ï¸  æ— æµ‹è¯•æ–‡ä»¶
ğŸ“ çŠ¶æ€: é…ç½®æ­£ç¡®ï¼Œä½†ç¼ºå°‘æµ‹è¯•æ–‡ä»¶
ğŸ”§ å»ºè®®: éœ€è¦æ·»åŠ æµ‹è¯•æ–‡ä»¶åˆ° src/ ç›®å½•
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æµ‹è¯•æ‰§è¡Œä¼˜åŒ–
- **å¹¶å‘æ§åˆ¶**: è®¾ç½® `maxConcurrency: 2` é¿å…èµ„æºç«äº‰
- **é‡è¯•æœºåˆ¶**: è®¾ç½® `retry: 2` æé«˜æµ‹è¯•ç¨³å®šæ€§
- **è¿›ç¨‹æ± **: ä½¿ç”¨ `pool: 'forks'` æé«˜æ€§èƒ½

### 2. è¦†ç›–ç‡ä¼˜åŒ–
- **V8 æä¾›è€…**: ä½¿ç”¨ `provider: 'v8'` è·å¾—æ›´å¥½çš„æ€§èƒ½
- **å¤šæ ¼å¼æŠ¥å‘Š**: æ”¯æŒ text, json, html, lcov æ ¼å¼
- **é˜ˆå€¼è®¾ç½®**: è®¾ç½®åˆç†çš„è¦†ç›–ç‡é˜ˆå€¼

### 3. ç¼“å­˜ä¼˜åŒ–
- **ç¼“å­˜ç›®å½•**: ä½¿ç”¨ `.vitest` ç›®å½•è¿›è¡Œç¼“å­˜
- **ä¾èµ–ä¼˜åŒ–**: æ’é™¤ä¸å¿…è¦çš„ä¾èµ–é¢„æ„å»º

## ğŸ”§ é…ç½®ç‰¹æ€§

### 1. è·¯å¾„åˆ«å
```typescript
resolve: {
  alias: {
    '@': path.resolve(__dirname, './src'),
    '@shared': path.resolve(__dirname, '../../shared'),
    '@components': path.resolve(__dirname, './src/components'),
    // ... å…¶ä»–åˆ«å
  },
}
```

### 2. ç¯å¢ƒå˜é‡
```typescript
define: {
  'process.env.NODE_ENV': '"test"',
}
```

### 3. ä¾èµ–ä¼˜åŒ–
```typescript
optimizeDeps: {
  exclude: ['@shared/hooks'],
  include: ['react', 'react-dom'],
}
```

## ğŸ“Š å‡çº§å‰åå¯¹æ¯”

| é¡¹ç›® | å‡çº§å‰ç‰ˆæœ¬ | å‡çº§åç‰ˆæœ¬ | æµ‹è¯•çŠ¶æ€ | é…ç½®ä¼˜åŒ– |
|------|------------|------------|----------|----------|
| Blog | 2.1.9 | 3.2.4 | âœ… é€šè¿‡ | âœ… é«˜æ€§èƒ½é…ç½® |
| Mobile | 2.0.0 | 3.2.4 | âš ï¸ æ— æµ‹è¯•æ–‡ä»¶ | âœ… é«˜æ€§èƒ½é…ç½® |

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### 1. Mobile åº”ç”¨
- æ·»åŠ æµ‹è¯•æ–‡ä»¶åˆ° `src/` ç›®å½•
- åˆ›å»ºç»„ä»¶æµ‹è¯•å’Œå·¥å…·å‡½æ•°æµ‹è¯•
- è®¾ç½®æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡

### 2. æŒç»­ä¼˜åŒ–
- ç›‘æ§æµ‹è¯•æ‰§è¡Œæ€§èƒ½
- æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´é…ç½®
- å®šæœŸæ›´æ–° Vitest ç‰ˆæœ¬

### 3. å›¢é˜Ÿåä½œ
- æ›´æ–°å¼€å‘æ–‡æ¡£
- åŸ¹è®­å›¢é˜Ÿæˆå‘˜ä½¿ç”¨æ–°çš„æµ‹è¯•é…ç½®
- å»ºç«‹æµ‹è¯•æœ€ä½³å®è·µ

## ğŸ“ æ€»ç»“

æœ¬æ¬¡å‡çº§æˆåŠŸå°† `@blog/` å’Œ `@mobile/` åº”ç”¨çš„ Vitest å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ 3.2.4ï¼Œå¹¶å®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š

- âœ… **ç‰ˆæœ¬å‡çº§**: æˆåŠŸå‡çº§åˆ° Vitest 3.2.4
- âœ… **é…ç½®ä¼˜åŒ–**: åº”ç”¨äº†é«˜æ€§èƒ½æµ‹è¯•é…ç½®
- âœ… **é—®é¢˜ä¿®å¤**: è§£å†³äº†æ‰€æœ‰ lint å’Œå¯¼å…¥é—®é¢˜
- âœ… **æµ‹è¯•éªŒè¯**: Blog åº”ç”¨æµ‹è¯•è¿è¡Œæ­£å¸¸
- âš ï¸ **å¾…å®Œå–„**: Mobile åº”ç”¨éœ€è¦æ·»åŠ æµ‹è¯•æ–‡ä»¶

å‡çº§åçš„é…ç½®ä¸ `@server/` åº”ç”¨ä¿æŒä¸€è‡´ï¼Œä¸ºæ•´ä¸ªé¡¹ç›®æä¾›äº†ç»Ÿä¸€çš„æµ‹è¯•ä½“éªŒå’Œæ€§èƒ½ä¼˜åŒ–ã€‚

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-03 22:12:00  
**å‡çº§ç‰ˆæœ¬**: Vitest 3.2.4  
**å‡çº§çŠ¶æ€**: âœ… å®Œæˆ
