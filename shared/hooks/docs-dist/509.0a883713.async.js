"use strict";(self.webpackChunk_corn12138_hooks=self.webpackChunk_corn12138_hooks||[]).push([[509],{68509:function(Be,fe,T){T.r(fe),T.d(fe,{AuthProvider:function(){return Ee},useApi:function(){return We},useAsync:function(){return me},useAuth:function(){return Ie},useClientSide:function(){return le},useClientSideEffect:function(){return Te},useClientState:function(){return Re},useDebounce:function(){return Oe},useDebouncedCallback:function(){return $e},useEditor:function(){return Ve},useForm:function(){return He},useLocalStorage:function(){return Me},useNetworkStatus:function(){return je},useWindowSize:function(){return ze},version:function(){return Je}});var Se=T(90819),V=T.n(Se),be=T(89933),K=T.n(be),ye=T(73193),n=T.n(ye),Ce=T(45332),j=T.n(Ce),e=T(44194),ke=T(31549),de=(0,e.createContext)(void 0),Ee=function(a){var u=a.children,s=(0,e.useState)({user:null,token:null,isLoading:!0,isAuthenticated:!1}),i=j()(s,2),g=i[0],l=i[1];(0,e.useEffect)(function(){var o=function(){if(typeof window!="undefined"){var w=localStorage.getItem("token"),c=localStorage.getItem("user");if(w&&c)try{var f=JSON.parse(c);l({user:f,token:w,isLoading:!1,isAuthenticated:!0})}catch(d){localStorage.removeItem("token"),localStorage.removeItem("user"),l(function(k){return n()(n()({},k),{},{isLoading:!1})})}else l(function(d){return n()(n()({},d),{},{isLoading:!1})})}};o()},[]);var I=(0,e.useCallback)(function(){var o=K()(V()().mark(function t(w){var c,f,d,k;return V()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l(function(D){return n()(n()({},D),{},{isLoading:!0})}),v.prev=1,v.next=4,fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});case 4:if(c=v.sent,c.ok){v.next=7;break}throw new Error("\u767B\u5F55\u5931\u8D25");case 7:return v.next=9,c.json();case 9:f=v.sent,d=f.user,k=f.token,typeof window!="undefined"&&(localStorage.setItem("token",k),localStorage.setItem("user",JSON.stringify(d))),l({user:d,token:k,isLoading:!1,isAuthenticated:!0}),v.next=20;break;case 16:throw v.prev=16,v.t0=v.catch(1),l(function(D){return n()(n()({},D),{},{isLoading:!1})}),v.t0;case 20:case"end":return v.stop()}},t,null,[[1,16]])}));return function(t){return o.apply(this,arguments)}}(),[]),m=(0,e.useCallback)(function(){typeof window!="undefined"&&(localStorage.removeItem("token"),localStorage.removeItem("user")),l({user:null,token:null,isLoading:!1,isAuthenticated:!1})},[]),y=(0,e.useCallback)(function(){var o=K()(V()().mark(function t(w){var c,f,d,k;return V()().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return l(function(D){return n()(n()({},D),{},{isLoading:!0})}),v.prev=1,v.next=4,fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});case 4:if(c=v.sent,c.ok){v.next=7;break}throw new Error("\u6CE8\u518C\u5931\u8D25");case 7:return v.next=9,c.json();case 9:f=v.sent,d=f.user,k=f.token,typeof window!="undefined"&&(localStorage.setItem("token",k),localStorage.setItem("user",JSON.stringify(d))),l({user:d,token:k,isLoading:!1,isAuthenticated:!0}),v.next=20;break;case 16:throw v.prev=16,v.t0=v.catch(1),l(function(D){return n()(n()({},D),{},{isLoading:!1})}),v.t0;case 20:case"end":return v.stop()}},t,null,[[1,16]])}));return function(t){return o.apply(this,arguments)}}(),[]),b=(0,e.useCallback)(function(o){l(function(t){if(!t.user)return t;var w=n()(n()({},t.user),o);return typeof window!="undefined"&&localStorage.setItem("user",JSON.stringify(w)),n()(n()({},t),{},{user:w})})},[]),C=n()(n()({},g),{},{login:I,logout:m,register:y,updateUser:b});return(0,ke.jsx)(de.Provider,{value:C,children:u})},Ie=function(){var a=(0,e.useContext)(de);if(a===void 0)throw new Error("useAuth\u5FC5\u987B\u5728AuthProvider\u5185\u90E8\u4F7F\u7528");return a},Ae=T(76711),re=T.n(Ae);function Oe(r,a){var u=(0,e.useState)(r),s=j()(u,2),i=s[0],g=s[1];return(0,e.useEffect)(function(){var l=setTimeout(function(){g(r)},a);return function(){clearTimeout(l)}},[r,a]),i}function $e(r,a){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=(0,e.useState)(function(){return r}),i=j()(s,2),g=i[0],l=i[1];return(0,e.useEffect)(function(){var I=setTimeout(function(){l(function(){return r})},a);return function(){clearTimeout(I)}},[r,a].concat(re()(u))),g}function le(){var r=(0,e.useState)(!1),a=j()(r,2),u=a[0],s=a[1];return(0,e.useEffect)(function(){s(!0)},[]),u}function Te(r,a){var u=le();(0,e.useEffect)(function(){if(u)return r()},[u].concat(re()(a||[])))}function Re(r){var a=le(),u=(0,e.useState)(r),s=j()(u,2),i=s[0],g=s[1];return[a?i:r,g]}var Le=T(86222),Fe=T.n(Le);function Ve(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=(0,e.useState)({components:r,selectedComponentId:null,draggedComponent:null,history:[r],historyIndex:0,mode:"design"}),u=j()(a,2),s=u[0],i=u[1],g=(0,e.useCallback)(function(o,t){i(function(w){var c=re()(w.components);if(t){var f=ve(c,t);f&&(f.children=f.children||[],f.children.push(n()(n()({},o),{},{parentId:t})))}else c.push(o);var d=w.history.slice(0,w.historyIndex+1);return d.push(c),n()(n()({},w),{},{components:c,history:d,historyIndex:d.length-1})})},[]),l=(0,e.useCallback)(function(o){i(function(t){var w=he(re()(t.components),o),c=t.history.slice(0,t.historyIndex+1);return c.push(w),n()(n()({},t),{},{components:w,selectedComponentId:t.selectedComponentId===o?null:t.selectedComponentId,history:c,historyIndex:c.length-1})})},[]),I=(0,e.useCallback)(function(o,t){i(function(w){var c=ge(re()(w.components),o,t),f=w.history.slice(0,w.historyIndex+1);return f.push(c),n()(n()({},w),{},{components:c,history:f,historyIndex:f.length-1})})},[]),m=(0,e.useCallback)(function(o){i(function(t){return n()(n()({},t),{},{selectedComponentId:o})})},[]),y=(0,e.useCallback)(function(){i(function(o){if(o.historyIndex>0){var t=o.historyIndex-1;return n()(n()({},o),{},{components:o.history[t],historyIndex:t})}return o})},[]),b=(0,e.useCallback)(function(){i(function(o){if(o.historyIndex<o.history.length-1){var t=o.historyIndex+1;return n()(n()({},o),{},{components:o.history[t],historyIndex:t})}return o})},[]),C=(0,e.useCallback)(function(){i(function(o){return n()(n()({},o),{},{mode:o.mode==="design"?"preview":"design"})})},[]);return n()(n()({},s),{},{addComponent:g,removeComponent:l,updateComponent:I,selectComponent:m,undo:y,redo:b,toggleMode:C,canUndo:s.historyIndex>0,canRedo:s.historyIndex<s.history.length-1})}function ve(r,a){var u=Fe()(r),s;try{for(u.s();!(s=u.n()).done;){var i=s.value;if(i.id===a)return i;if(i.children){var g=ve(i.children,a);if(g)return g}}}catch(l){u.e(l)}finally{u.f()}return null}function he(r,a){return r.filter(function(u){return u.id===a?!1:(u.children&&(u.children=he(u.children,a)),!0)})}function ge(r,a,u){return r.map(function(s){return s.id===a?n()(n()({},s),u):s.children?n()(n()({},s),{},{children:ge(s.children,a,u)}):s})}function me(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r!="function")throw new Error("useAsync: asyncFunction must be a function");var u=a.immediate,s=u===void 0?!1:u,i=a.onSuccess,g=a.onError,l=a.retryCount,I=l===void 0?0:l,m=a.retryDelay,y=m===void 0?1e3:m,b=(0,e.useState)(null),C=j()(b,2),o=C[0],t=C[1],w=(0,e.useState)(!1),c=j()(w,2),f=c[0],d=c[1],k=(0,e.useState)(null),U=j()(k,2),v=U[0],D=U[1],H=(0,e.useRef)(),L=(0,e.useRef)(),R=(0,e.useRef)(0),P=(0,e.useRef)(!0);(0,e.useEffect)(function(){return P.current=!0,function(){var A;P.current=!1,(A=H.current)===null||A===void 0||A.call(H)}},[]);var B=(0,e.useCallback)(function(A){return new Promise(function(M,X){var E=setTimeout(M,A),N=H.current;H.current=function(){clearTimeout(E),N==null||N(),X(new Error("Operation cancelled"))}})},[]),W=(0,e.useCallback)(K()(V()().mark(function A(){var M,X,E,N,ne,te=arguments;return V()().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:for(M=te.length,X=new Array(M),E=0;E<M;E++)X[E]=te[E];if(P.current){Z.next=3;break}return Z.abrupt("return");case 3:return L.current=X,R.current=0,d(!0),D(null),N=!1,H.current=function(){N=!0},ne=function(){var ce=K()(V()().mark(function se(){var q,_,ee,ae;return V()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:q=0,_=I+1;case 2:if(!(q<_)){h.next=44;break}if(h.prev=3,!(N||!P.current)){h.next=6;break}return h.abrupt("return");case 6:return h.next=8,r.apply(void 0,X);case 8:if(ee=h.sent,!(N||!P.current)){h.next=11;break}return h.abrupt("return");case 11:return t(ee),d(!1),i==null||i(ee),h.abrupt("return");case 17:if(h.prev=17,h.t0=h.catch(3),!(N||!P.current)){h.next=21;break}return h.abrupt("return");case 21:if(ae=h.t0 instanceof Error?h.t0:new Error("Unknown error"),q++,!(q<_)){h.next=38;break}if(h.prev=24,!(N||!P.current)){h.next=27;break}return h.abrupt("return");case 27:return h.next=29,B(y);case 29:if(!(N||!P.current)){h.next=31;break}return h.abrupt("return");case 31:h.next=36;break;case 33:return h.prev=33,h.t1=h.catch(24),h.abrupt("return");case 36:h.next=42;break;case 38:return D(ae.message),d(!1),g==null||g(ae),h.abrupt("return");case 42:h.next=2;break;case 44:case"end":return h.stop()}},se,null,[[3,17],[24,33]])}));return function(){return ce.apply(this,arguments)}}(),Z.next=12,ne();case 12:case"end":return Z.stop()}},A)})),[r,i,g,I,y,B]),x=(0,e.useCallback)(function(){var A;t(null),D(null),d(!1),(A=H.current)===null||A===void 0||A.call(H),R.current=0},[]),G=(0,e.useCallback)(function(){var A;(A=H.current)===null||A===void 0||A.call(H),d(!1)},[]),Q=(0,e.useCallback)(function(){L.current&&W.apply(void 0,re()(L.current))},[W]);return(0,e.useEffect)(function(){s&&W()},[W,s]),{data:o,loading:f,error:v,execute:W,reset:x,cancel:G,retry:Q}}function je(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=(0,e.useState)(typeof window!="undefined"?navigator.onLine:!0),u=j()(a,2),s=u[0],i=u[1],g=(0,e.useCallback)(K()(V()().mark(function I(){var m;return V()().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(typeof window!="undefined"){b.next=2;break}return b.abrupt("return",!0);case 2:return b.prev=2,b.next=5,fetch("/ping",{method:"HEAD",cache:"no-cache",signal:AbortSignal.timeout(5e3)});case 5:return m=b.sent,b.abrupt("return",m.ok);case 9:return b.prev=9,b.t0=b.catch(2),b.abrupt("return",!1);case 12:case"end":return b.stop()}},I,null,[[2,9]])})),[]),l=(0,e.useCallback)(function(){typeof window!="undefined"&&g().then(function(I){if(i(I),I){var m;(m=r.onOnline)===null||m===void 0||m.call(r)}else{var y;(y=r.onOffline)===null||y===void 0||y.call(r)}})},[g,r]);return(0,e.useEffect)(function(){if(typeof window!="undefined"){var I=function(){var C;i(!0),(C=r.onOnline)===null||C===void 0||C.call(r)},m=function(){var C;i(!1),(C=r.onOffline)===null||C===void 0||C.call(r)};window.addEventListener("online",I),window.addEventListener("offline",m);var y=setInterval(function(){g().then(function(b){i(b)})},3e4);return function(){window.removeEventListener("online",I),window.removeEventListener("offline",m),clearInterval(y)}}},[g,r]),{isOnline:s,reconnect:l,checkConnectivity:g}}var De=T(10154),ue=T.n(De),Pe=T(89957),Ne=T.n(Pe);function He(r){if(!r.initialValues||Ne()(r.initialValues)!=="object")throw new Error("useForm: initialValues is required and must be an object");var a=r.initialValues,u=r.validate,s=r.fieldValidators,i=r.onSubmit,g=r.validateMode,l=g===void 0?"onSubmit":g,I=r.reValidateMode,m=I===void 0?"onChange":I,y=r.focusFirstError,b=y===void 0?!0:y,C=(0,e.useState)(a),o=j()(C,2),t=o[0],w=o[1],c=(0,e.useState)({}),f=j()(c,2),d=f[0],k=f[1],U=(0,e.useState)({}),v=j()(U,2),D=v[0],H=v[1],L=(0,e.useState)(!1),R=j()(L,2),P=R[0],B=R[1],W=(0,e.useState)(!1),x=j()(W,2),G=x[0],Q=x[1],A=(0,e.useRef)(a),M=(0,e.useRef)(null),X=Object.keys(t).some(function(S){return t[S]!==A.current[S]}),E=Object.keys(d).length===0,N=(0,e.useCallback)(function(){var S=K()(V()().mark(function p(O){var F,z,Y;return V()().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return z=s==null?void 0:s[O],z&&(F=z(t[O],t)),!F&&u&&(Y=u(t),F=Y[O]),J.abrupt("return",F);case 4:case"end":return J.stop()}},p)}));return function(p){return S.apply(this,arguments)}}(),[t,u,s]),ne=(0,e.useCallback)(K()(V()().mark(function S(){var p,O,F,z,Y,$,J,ie;return V()().wrap(function(oe){for(;;)switch(oe.prev=oe.next){case 0:if(p={},u&&(O=u(t),Object.assign(p,O)),s)for(F=0,z=Object.entries(s);F<z.length;F++)Y=j()(z[F],2),$=Y[0],J=Y[1],J&&(ie=J(t[$],t),ie&&(p[$]=ie));return oe.abrupt("return",p);case 4:case"end":return oe.stop()}},S)})),[t,u,s]),te=(0,e.useCallback)(function(S,p){w(function(O){return n()(n()({},O),{},ue()({},S,p))}),G&&(l==="onChange"||m==="onChange")&&N(S).then(function(O){k(function(F){return n()(n()({},F),{},ue()({},S,O))})})},[N,l,m,G]),pe=(0,e.useCallback)(function(S){w(function(p){return n()(n()({},p),S)})},[]),Z=(0,e.useCallback)(function(S,p){k(function(O){return n()(n()({},O),{},ue()({},S,p))})},[]),ce=(0,e.useCallback)(function(S){k(S)},[]),se=(0,e.useCallback)(function(){k({})},[]),q=(0,e.useCallback)(function(S){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;H(function(O){return n()(n()({},O),{},ue()({},S,p))})},[]),_=(0,e.useCallback)(function(S){var p=S.target,O=p.name,F=p.value,z=p.type,Y=z==="checkbox"?S.target.checked:F;te(O,Y)},[te]),ee=(0,e.useCallback)(function(S){var p=S.target.name;q(p,!0),(l==="onBlur"||G&&m==="onBlur")&&N(p).then(function(O){k(function(F){return n()(n()({},F),{},ue()({},p,O))})})},[q,N,l,m,G]),ae=(0,e.useCallback)(function(){if(!(!b||!M.current)){var S=Object.keys(d)[0];if(S){var p=M.current.querySelector('[name="'.concat(S,'"]'));p==null||p.focus()}}},[d,b]),we=(0,e.useCallback)(function(){var S=K()(V()().mark(function p(O){var F,z;return V()().wrap(function($){for(;;)switch($.prev=$.next){case 0:return O==null||O.preventDefault(),Q(!0),$.next=4,ne();case 4:if(F=$.sent,k(F),z=Object.keys(t).reduce(function(J,ie){return J[ie]=!0,J},{}),H(z),Object.keys(F).length!==0){$.next=24;break}if(!i){$.next=22;break}return B(!0),$.prev=11,$.next=14,i(t);case 14:$.next=19;break;case 16:$.prev=16,$.t0=$.catch(11),console.error("Form submission error:",$.t0);case 19:return $.prev=19,B(!1),$.finish(19);case 22:$.next=25;break;case 24:setTimeout(ae,0);case 25:case"end":return $.stop()}},p,null,[[11,16,19,22]])}));return function(p){return S.apply(this,arguments)}}(),[t,ne,i,ae]),h=(0,e.useCallback)(function(){w(a),k({}),H({}),B(!1),Q(!1)},[a]),Ue=(0,e.useCallback)(function(S){var p;return{name:String(S),value:(p=t[S])!==null&&p!==void 0?p:"",onChange:_,onBlur:ee,error:d[S],touched:D[S]}},[t,_,ee,d,D]);return(0,e.useEffect)(function(){a!==A.current&&(A.current=a,w(a))},[a]),{values:t,errors:d,touched:D,isSubmitting:P,isValid:E,isDirty:X,isValidated:G,setFieldValue:te,setValues:pe,setFieldError:Z,setErrors:ce,clearErrors:se,setFieldTouched:q,handleChange:_,handleBlur:ee,handleSubmit:we,validateField:N,validateForm:ne,reset:h,getFieldProps:Ue}}function Me(r,a){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=u.serializer,i=s===void 0?{read:JSON.parse,write:JSON.stringify}:s,g=u.syncAcrossTabs,l=g===void 0?!0:g,I=u.onError,m=I===void 0?console.error:I,y=(0,e.useCallback)(function(){if(typeof window=="undefined")return a;try{var f=window.localStorage.getItem(r);return f?i.read(f):a}catch(d){return m(d),a}},[a,r,i,m]),b=(0,e.useState)(y),C=j()(b,2),o=C[0],t=C[1],w=(0,e.useCallback)(function(f){if(typeof window!="undefined")try{var d=f instanceof Function?f(o):f;window.localStorage.setItem(r,i.write(d)),t(d),l&&window.dispatchEvent(new StorageEvent("storage",{key:r,newValue:i.write(d),oldValue:window.localStorage.getItem(r)}))}catch(k){m(k)}},[r,i,o,l,m]),c=(0,e.useCallback)(function(){if(typeof window!="undefined")try{window.localStorage.removeItem(r),t(a),l&&window.dispatchEvent(new StorageEvent("storage",{key:r,newValue:null,oldValue:window.localStorage.getItem(r)}))}catch(f){m(f)}},[r,a,l,m]);return(0,e.useEffect)(function(){if(!(!l||typeof window=="undefined")){var f=function(k){if(k.key===r)try{k.newValue===null?t(a):t(i.read(k.newValue))}catch(U){m(U)}};return window.addEventListener("storage",f),function(){return window.removeEventListener("storage",f)}}},[r,a,i,l,m]),(0,e.useEffect)(function(){t(y())},[y]),[o,w,c]}function ze(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r.debounceMs,u=a===void 0?100:a,s=r.initialWidth,i=s===void 0?1024:s,g=r.initialHeight,l=g===void 0?768:g,I=(0,e.useState)(function(){return typeof window=="undefined"?{width:i,height:l}:{width:window.innerWidth,height:window.innerHeight}}),m=j()(I,2),y=m[0],b=m[1];return(0,e.useEffect)(function(){if(typeof window!="undefined"){var C,o=function(){clearTimeout(C),C=setTimeout(function(){b({width:window.innerWidth,height:window.innerHeight})},u)};return window.addEventListener("resize",o),o(),function(){window.removeEventListener("resize",o),clearTimeout(C)}}},[u]),y}function We(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=r.baseURL,u=a===void 0?"":a,s=r.headers,i=s===void 0?{}:s,g=r.transform,l=g===void 0?function(L){return L}:g,I=r.onSuccess,m=r.onError,y=(0,e.useRef)(null),b=(0,e.useCallback)(function(){var L=K()(V()().mark(function R(P){var B,W,x,G,Q,A,M=arguments;return V()().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return B=M.length>1&&M[1]!==void 0?M[1]:{},y.current&&y.current.abort(),W=new AbortController,y.current=W,x=u?"".concat(u).concat(P):P,G=n()(n()({},B),{},{signal:W.signal,headers:n()(n()({"Content-Type":"application/json"},i),B.headers)}),E.prev=6,E.next=9,fetch(x,G);case 9:if(Q=E.sent,Q.ok){E.next=12;break}throw new Error("HTTP error! status: ".concat(Q.status));case 12:return E.next=14,Q.json();case 14:return A=E.sent,E.abrupt("return",l(A));case 18:if(E.prev=18,E.t0=E.catch(6),!(E.t0 instanceof Error&&E.t0.name==="AbortError")){E.next=22;break}throw new Error("Request was cancelled");case 22:throw E.t0;case 23:case"end":return E.stop()}},R,null,[[6,18]])}));return function(R){return L.apply(this,arguments)}}(),[u,i,l]),C=me(b,{onSuccess:I,onError:m}),o=C.data,t=C.loading,w=C.error,c=C.execute,f=C.reset,d=(0,e.useCallback)(function(L,R){return c(L,R)},[c]),k=(0,e.useCallback)(function(L,R){return c(L,n()(n()({},R),{},{method:"GET"}))},[c]),U=(0,e.useCallback)(function(L,R,P){return c(L,n()(n()({},P),{},{method:"POST",body:R?JSON.stringify(R):void 0}))},[c]),v=(0,e.useCallback)(function(L,R,P){return c(L,n()(n()({},P),{},{method:"PUT",body:R?JSON.stringify(R):void 0}))},[c]),D=(0,e.useCallback)(function(L,R){return c(L,n()(n()({},R),{},{method:"DELETE"}))},[c]),H=(0,e.useCallback)(function(){y.current&&(y.current.abort(),y.current=null),f()},[f]);return{data:o,loading:t,error:w,request:d,get:k,post:U,put:v,delete:D,reset:H}}var Je="1.0.0"}}]);
