# å®Œæ•´ç‰ˆ main.py æ¢å¤ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

ç»è¿‡å…¼å®¹æ€§é—®é¢˜æ’æŸ¥å’Œä¿®å¤ï¼Œæˆ‘ä»¬æˆåŠŸæ¢å¤äº†å®Œæ•´ç‰ˆ `main.py` çš„ä½¿ç”¨ï¼Œæä¾›äº†ä¼ä¸šçº§æµ‹è¯•ç¼–æ’å™¨çš„å…¨éƒ¨åŠŸèƒ½ã€‚

## è§£å†³çš„é—®é¢˜

### 1. Python 3.13 å…¼å®¹æ€§é—®é¢˜
- **é—®é¢˜**: Python 3.13 ä¸Š pydantic-core å’Œ typer å­˜åœ¨å…¼å®¹æ€§é—®é¢˜
- **è§£å†³æ–¹æ¡ˆ**: åˆ‡æ¢åˆ° Python 3.11.0ï¼Œè·å¾—æ›´å¥½çš„ç”Ÿæ€å…¼å®¹æ€§

### 2. Typer Rich é›†æˆé—®é¢˜
- **é—®é¢˜**: `TypeError: Parameter.make_metavar() missing 1 required positional argument: 'ctx'`
- **æ ¹æœ¬åŸå› **: typer çš„ rich é›†æˆåœ¨æŸäº›ç‰ˆæœ¬ç»„åˆä¸‹æœ‰ API ä¸å…¼å®¹é—®é¢˜
- **è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ç»è¿‡éªŒè¯çš„ç‰ˆæœ¬ç»„åˆï¼š
  - `click==8.0.4`
  - `typer==0.4.2` (æ—  rich é›†æˆé—®é¢˜çš„ç¨³å®šç‰ˆæœ¬)

### 3. ä»£ç è´¨é‡é—®é¢˜
- **é—®é¢˜**: main.py ä¸­æœ‰å¤šä¸ª linting é”™è¯¯
- **è§£å†³æ–¹æ¡ˆ**: æ¸…ç†æœªä½¿ç”¨çš„å¯¼å…¥ï¼Œä¿®å¤ä»£ç æ ¼å¼é—®é¢˜

## æˆåŠŸæ¢å¤çš„åŠŸèƒ½

### âœ… å®Œæ•´çš„ CLI å‘½ä»¤

```bash
# ä¸»è¦å‘½ä»¤
python main.py run --suite unit --app blog     # è¿è¡Œæµ‹è¯•
python main.py status                          # ç³»ç»ŸçŠ¶æ€
python main.py config-validate                 # é…ç½®éªŒè¯
python main.py flaky --list                    # Flaky æµ‹è¯•ç®¡ç†
python main.py health                          # å¥åº·æ£€æŸ¥
python main.py interactive                     # äº¤äº’å¼æ¨¡å¼
python main.py watch --app blog                # æ–‡ä»¶ç›‘æ§æ¨¡å¼
python main.py list-apps                       # åˆ—å‡ºåº”ç”¨
python main.py retry                           # é‡è¯•å¤±è´¥æµ‹è¯•
```

### âœ… Rich æ ¼å¼åŒ–è¾“å‡º

ç°åœ¨å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼š
- ğŸ“Š å½©è‰²è¡¨æ ¼è¾“å‡º
- ğŸ¨ Rich æ§åˆ¶å°ç¾åŒ–
- ğŸ“ˆ è¿›åº¦æ¡æ˜¾ç¤º
- ğŸŒˆ è¯­æ³•é«˜äº®

### âœ… é«˜çº§åŠŸèƒ½

1. **æ™ºèƒ½æµ‹è¯•**
   ```bash
   python main.py run --changed-only  # ä»…è¿è¡Œå˜æ›´ç›¸å…³çš„æµ‹è¯•
   ```

2. **Flaky æµ‹è¯•ç®¡ç†**
   ```bash
   python main.py flaky --list        # åˆ—å‡º flaky æµ‹è¯•
   python main.py flaky --clear       # æ¸…ç©º flaky åˆ—è¡¨
   ```

3. **äº¤äº’å¼æ¨¡å¼**
   ```bash
   python main.py interactive         # å›¾å½¢åŒ–é€‰æ‹©æµ‹è¯•é€‰é¡¹
   ```

4. **æ–‡ä»¶ç›‘æ§**
   ```bash
   python main.py watch --app blog    # ç›‘æ§æ–‡ä»¶å˜æ›´è‡ªåŠ¨è¿è¡Œæµ‹è¯•
   ```

## ç¯å¢ƒè¦æ±‚

### å¿…éœ€ç‰ˆæœ¬
- **Python**: 3.11.0 (æ¨è)
- **å…³é”®ä¾èµ–**:
  ```
  click==8.0.4
  typer==0.4.2
  rich==13.7.1
  pydantic==2.5.3
  ```

### å®‰è£…æ–¹æ³•

```bash
# 1. è®¾ç½® Python ç‰ˆæœ¬
pyenv local 3.11.0

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate

# 3. å®‰è£…ä¾èµ–
pip install -r requirements-python311.txt

# 4. éªŒè¯å®‰è£…
python main.py --help
```

## å¿«é€Ÿå¯åŠ¨

### ä½¿ç”¨å¯åŠ¨è„šæœ¬
```bash
cd testing/orchestrator
./start.sh                          # æ˜¾ç¤ºå¸®åŠ©
./start.sh config-validate          # éªŒè¯é…ç½®
./start.sh status                   # æŸ¥çœ‹çŠ¶æ€
./start.sh run --suite unit         # è¿è¡Œå•å…ƒæµ‹è¯•
```

### ç›´æ¥è¿è¡Œ
```bash
cd testing/orchestrator
source venv/bin/activate
python main.py [command] [options]
```

## åŠŸèƒ½æ¼”ç¤º

### 1. ç³»ç»ŸçŠ¶æ€
```bash
python main.py status
```
è¾“å‡ºï¼š
```
ğŸ“Š ç³»ç»ŸçŠ¶æ€

                              é¡¹ç›®ä¿¡æ¯                              
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ å±æ€§         â”ƒ å€¼                                                â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ é¡¹ç›®åç§°     â”‚ AI-Code Monorepo                                  â”‚
â”‚ é¡¹ç›®è·¯å¾„     â”‚ /Users/huangyuming/Desktop/createProjects/AI-code â”‚
â”‚ å¹¶è¡Œå·¥ä½œè¿›ç¨‹ â”‚ 6                                                 â”‚
â”‚ æµ‹è¯•è¶…æ—¶     â”‚ 3600s                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

             åº”ç”¨é…ç½®              
â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”“
â”ƒ åº”ç”¨   â”ƒ ç±»å‹   â”ƒ ç«¯å£ â”ƒ ä¾èµ–   â”ƒ
â”¡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”©
â”‚ blog   â”‚ nextjs â”‚ 3000 â”‚ server â”‚
â”‚ server â”‚ nestjs â”‚ 3001 â”‚ æ—      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. é…ç½®éªŒè¯
```bash
python main.py config-validate
```
è¾“å‡ºï¼š
```
âœ… é…ç½®æ–‡ä»¶éªŒè¯é€šè¿‡
ğŸ“‹ é¡¹ç›®: AI-Code Monorepo
ğŸ“± åº”ç”¨æ•°é‡: 2
ğŸ§ª æµ‹è¯•å¥—ä»¶: 0
```

## ä¼˜åŠ¿å¯¹æ¯”

| åŠŸèƒ½ | main.py (å®Œæ•´ç‰ˆ) | simple_main.py (å·²åˆ é™¤) |
|------|-----------------|----------------------|
| CLI æ¡†æ¶ | typer (åŠŸèƒ½ä¸°å¯Œ) | argparse (åŸºç¡€) |
| ç•Œé¢ç¾è§‚ | Rich æ ¼å¼åŒ– | çº¯æ–‡æœ¬ |
| äº¤äº’æ¨¡å¼ | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| æ–‡ä»¶ç›‘æ§ | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| è¿›åº¦æ¡ | âœ… Rich è¿›åº¦æ¡ | âŒ æ—  |
| è¡¨æ ¼è¾“å‡º | âœ… æ ¼å¼åŒ–è¡¨æ ¼ | âŒ ç®€å•åˆ—è¡¨ |
| é”™è¯¯å¤„ç† | âœ… å‹å¥½æç¤º | âš ï¸ åŸºç¡€ |
| å¸®åŠ©ç³»ç»Ÿ | âœ… ä¸°å¯Œå¸®åŠ© | âš ï¸ åŸºç¡€ |

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼štyper å¯¼å…¥é”™è¯¯
```bash
# æ£€æŸ¥ç‰ˆæœ¬
pip list | grep typer
pip list | grep click

# é‡æ–°å®‰è£…æ­£ç¡®ç‰ˆæœ¬
pip install click==8.0.4 typer==0.4.2
```

### é—®é¢˜ï¼šRich æ˜¾ç¤ºå¼‚å¸¸
```bash
# æ£€æŸ¥ç»ˆç«¯æ”¯æŒ
python -c "from rich.console import Console; Console().print('âœ… Rich æ­£å¸¸')"

# æ›´æ–° rich
pip install rich==13.7.1
```

### é—®é¢˜ï¼šé…ç½®æ–‡ä»¶æ‰¾ä¸åˆ°
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls ../config.yml

# éªŒè¯è·¯å¾„
python main.py config-validate
```

## å¼€å‘å»ºè®®

### IDE é…ç½®
- **PyCharm**: ä½¿ç”¨é¡¹ç›®è™šæ‹Ÿç¯å¢ƒä½œä¸ºè§£é‡Šå™¨
- **VS Code**: é…ç½® Python è·¯å¾„ä¸º `./venv/bin/python`

### è°ƒè¯•æ–¹æ³•
```bash
# è¯¦ç»†æ—¥å¿—
python main.py run --verbose --debug

# å•æ­¥è°ƒè¯•
python -m pdb main.py run --suite unit
```

### æ‰©å±•å¼€å‘
- æ–°å¢å‘½ä»¤ï¼šåœ¨ `main.py` ä¸­æ·»åŠ  `@app.command()` è£…é¥°çš„å‡½æ•°
- ä¿®æ”¹è¾“å‡ºï¼šä½¿ç”¨ `rich.console.Console` è¿›è¡Œæ ¼å¼åŒ–
- æ·»åŠ é€‰é¡¹ï¼šä½¿ç”¨ `typer.Option()` å®šä¹‰å‘½ä»¤è¡Œå‚æ•°

## æ€»ç»“

é€šè¿‡è§£å†³ Python ç‰ˆæœ¬å…¼å®¹æ€§å’Œ typer ç‰ˆæœ¬é—®é¢˜ï¼Œæˆ‘ä»¬æˆåŠŸæ¢å¤äº†åŠŸèƒ½å®Œæ•´çš„ `main.py`ã€‚ç°åœ¨ç”¨æˆ·å¯ä»¥äº«å—åˆ°ï¼š

1. âœ… **å®Œæ•´çš„ä¼ä¸šçº§æµ‹è¯•ç¼–æ’åŠŸèƒ½**
2. âœ… **ç¾è§‚çš„ Rich æ ¼å¼åŒ–è¾“å‡º**
3. âœ… **ç¨³å®šçš„ Python 3.11 ç¯å¢ƒ**
4. âœ… **ç»è¿‡éªŒè¯çš„ä¾èµ–ç‰ˆæœ¬ç»„åˆ**
5. âœ… **ä¾¿æ·çš„å¯åŠ¨è„šæœ¬**

è¿™ä¸ºåç»­çš„æµ‹è¯•ç³»ç»Ÿå¼€å‘å’Œä½¿ç”¨æä¾›äº†åšå®çš„åŸºç¡€ã€‚
